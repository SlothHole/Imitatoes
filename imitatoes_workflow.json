{
  "requirements": {
    "comfyui_version": ">=0.4.0",
    "models": {
      "checkpoint": "sdxl_base_1.0.safetensors",
      "vae": "sdxl_vae.safetensors",
      "vision_llm": "llava-v1.6-mistral-7b.Q4_K_M.gguf"
    },
    "custom_nodes": [
      {
        "name": "ComfyUI-Impact-Pack",
        "repo": "https://github.com/ltdrdata/ComfyUI-Impact-Pack",
        "purpose": "Loop control nodes for iterative refinement."
      },
      {
        "name": "ComfyUI-LLava",
        "repo": "https://github.com/aniketmaurya/ComfyUI-LLava",
        "purpose": "Local vision LLM critique of rendered images."
      },
      {
        "name": "ComfyUI-String-Tools",
        "repo": "https://github.com/cubiq/ComfyUI-String-Tools",
        "purpose": "Prompt editing and concatenation utilities."
      }
    ]
  },
  "workflow": {
    "last_node_id": 19,
    "last_link_id": 28,
    "nodes": [
      {
        "id": 1,
        "type": "CheckpointLoaderSimple",
        "pos": [
          -762,
          -238
        ],
        "size": {
          "0": 315,
          "1": 98
        },
        "flags": {},
        "order": 0,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "MODEL",
            "type": "MODEL",
            "links": [
              1
            ]
          },
          {
            "name": "CLIP",
            "type": "CLIP",
            "links": [
              2
            ]
          },
          {
            "name": "VAE",
            "type": "VAE",
            "links": [
              3
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "CheckpointLoaderSimple"
        },
        "widgets_values": [
          "sdxl_base_1.0.safetensors"
        ]
      },
      {
        "id": 2,
        "type": "CLIPTextEncode",
        "pos": [
          -375,
          -353
        ],
        "size": {
          "0": 356,
          "1": 98
        },
        "flags": {},
        "order": 1,
        "mode": 0,
        "inputs": [
          {
            "name": "clip",
            "type": "CLIP",
            "link": 2
          },
          {
            "name": "text",
            "type": "STRING",
            "link": 21
          }
        ],
        "outputs": [
          {
            "name": "CONDITIONING",
            "type": "CONDITIONING",
            "links": [
              4
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "CLIPTextEncode"
        }
      },
      {
        "id": 3,
        "type": "CLIPTextEncode",
        "pos": [
          -366,
          -206
        ],
        "size": {
          "0": 356,
          "1": 98
        },
        "flags": {},
        "order": 2,
        "mode": 0,
        "inputs": [
          {
            "name": "clip",
            "type": "CLIP",
            "link": 2
          },
          {
            "name": "text",
            "type": "STRING",
            "link": 22
          }
        ],
        "outputs": [
          {
            "name": "CONDITIONING",
            "type": "CONDITIONING",
            "links": [
              5
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "CLIPTextEncode"
        }
      },
      {
        "id": 4,
        "type": "EmptyLatentImage",
        "pos": [
          -376,
          -63
        ],
        "size": {
          "0": 320,
          "1": 122
        },
        "flags": {},
        "order": 3,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "LATENT",
            "type": "LATENT",
            "links": [
              6
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "EmptyLatentImage"
        },
        "widgets_values": [
          1024,
          1024,
          1
        ]
      },
      {
        "id": 5,
        "type": "KSampler",
        "pos": [
          39,
          -246
        ],
        "size": {
          "0": 315,
          "1": 262
        },
        "flags": {},
        "order": 4,
        "mode": 0,
        "inputs": [
          {
            "name": "model",
            "type": "MODEL",
            "link": 1
          },
          {
            "name": "positive",
            "type": "CONDITIONING",
            "link": 4
          },
          {
            "name": "negative",
            "type": "CONDITIONING",
            "link": 5
          },
          {
            "name": "latent_image",
            "type": "LATENT",
            "link": 6
          }
        ],
        "outputs": [
          {
            "name": "LATENT",
            "type": "LATENT",
            "links": [
              7
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "KSampler"
        },
        "widgets_values": [
          658887569,
          "randomize",
          28,
          7.5,
          "dpmpp_2m",
          "karras",
          1
        ]
      },
      {
        "id": 6,
        "type": "VAEDecode",
        "pos": [
          388,
          -240
        ],
        "size": {
          "0": 210,
          "1": 58
        },
        "flags": {},
        "order": 5,
        "mode": 0,
        "inputs": [
          {
            "name": "samples",
            "type": "LATENT",
            "link": 7
          },
          {
            "name": "vae",
            "type": "VAE",
            "link": 3
          }
        ],
        "outputs": [
          {
            "name": "IMAGE",
            "type": "IMAGE",
            "links": [
              8,
              16
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "VAEDecode"
        }
      },
      {
        "id": 7,
        "type": "SaveImage",
        "pos": [
          723,
          -240
        ],
        "size": {
          "0": 264,
          "1": 58
        },
        "flags": {},
        "order": 6,
        "mode": 0,
        "inputs": [
          {
            "name": "images",
            "type": "IMAGE",
            "link": 8
          }
        ],
        "outputs": [],
        "properties": {
          "Node name for S&R": "SaveImage"
        },
        "widgets_values": [
          "imitatoes"
        ]
      },
      {
        "id": 8,
        "type": "String",
        "pos": [
          -760,
          -414
        ],
        "size": {
          "0": 315,
          "1": 58
        },
        "flags": {},
        "order": 7,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "STRING",
            "type": "STRING",
            "links": [
              21
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "String"
        },
        "widgets_values": [
          "A cinematic portrait of a golden retriever astronaut floating in a space station, dramatic lighting, ultra detailed, 35mm photography"
        ]
      },
      {
        "id": 9,
        "type": "String",
        "pos": [
          -761,
          -309
        ],
        "size": {
          "0": 315,
          "1": 58
        },
        "flags": {},
        "order": 8,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "STRING",
            "type": "STRING",
            "links": [
              22
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "String"
        },
        "widgets_values": [
          "lowres, blurry, bad anatomy, text, watermark"
        ]
      },
      {
        "id": 10,
        "type": "LLavaLoader",
        "pos": [
          402,
          112
        ],
        "size": {
          "0": 355,
          "1": 82
        },
        "flags": {},
        "order": 9,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "MODEL",
            "type": "LLAVA_MODEL",
            "links": [
              9
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "LLavaLoader"
        },
        "widgets_values": [
          "llava-v1.6-mistral-7b.Q4_K_M.gguf"
        ]
      },
      {
        "id": 11,
        "type": "LLavaVisionEncode",
        "pos": [
          401,
          237
        ],
        "size": {
          "0": 348,
          "1": 82
        },
        "flags": {},
        "order": 10,
        "mode": 0,
        "inputs": [
          {
            "name": "images",
            "type": "IMAGE",
            "link": 16
          }
        ],
        "outputs": [
          {
            "name": "VISION_EMBEDDING",
            "type": "LLAVA_VISION",
            "links": [
              10
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "LLavaVisionEncode"
        }
      },
      {
        "id": 12,
        "type": "LLavaCaption",
        "pos": [
          806,
          174
        ],
        "size": {
          "0": 400,
          "1": 210
        },
        "flags": {},
        "order": 11,
        "mode": 0,
        "inputs": [
          {
            "name": "model",
            "type": "LLAVA_MODEL",
            "link": 9
          },
          {
            "name": "vision",
            "type": "LLAVA_VISION",
            "link": 10
          }
        ],
        "outputs": [
          {
            "name": "STRING",
            "type": "STRING",
            "links": [
              11
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "LLavaCaption"
        },
        "widgets_values": [
          "You are a strict image critic. Compare the rendered image to the goal spec and provide a concise improvement instruction. Reply with either DONE or a revised prompt only. Goal spec: cinematic golden retriever astronaut floating in a space station, dramatic lighting, ultra detailed, 35mm photography."
        ]
      },
      {
        "id": 13,
        "type": "StringReplace",
        "pos": [
          1234,
          171
        ],
        "size": {
          "0": 320,
          "1": 82
        },
        "flags": {},
        "order": 12,
        "mode": 0,
        "inputs": [
          {
            "name": "text",
            "type": "STRING",
            "link": 11
          }
        ],
        "outputs": [
          {
            "name": "STRING",
            "type": "STRING",
            "links": [
              12
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "StringReplace"
        },
        "widgets_values": [
          "DONE",
          "",
          true
        ]
      },
      {
        "id": 14,
        "type": "ImpactLoopStart",
        "pos": [
          -1102,
          -120
        ],
        "size": {
          "0": 304,
          "1": 130
        },
        "flags": {},
        "order": 13,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "ITERATION",
            "type": "INT",
            "links": [
              13
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "ImpactLoopStart"
        },
        "widgets_values": [
          5
        ]
      },
      {
        "id": 15,
        "type": "ImpactLoopEnd",
        "pos": [
          1569,
          170
        ],
        "size": {
          "0": 304,
          "1": 110
        },
        "flags": {},
        "order": 14,
        "mode": 0,
        "inputs": [
          {
            "name": "iteration",
            "type": "INT",
            "link": 13
          },
          {
            "name": "continue",
            "type": "BOOLEAN",
            "link": 14
          }
        ],
        "outputs": [
          {
            "name": "LOOP",
            "type": "LOOP",
            "links": []
          }
        ],
        "properties": {
          "Node name for S&R": "ImpactLoopEnd"
        }
      },
      {
        "id": 16,
        "type": "StringContains",
        "pos": [
          1234,
          284
        ],
        "size": {
          "0": 320,
          "1": 82
        },
        "flags": {},
        "order": 15,
        "mode": 0,
        "inputs": [
          {
            "name": "text",
            "type": "STRING",
            "link": 11
          }
        ],
        "outputs": [
          {
            "name": "BOOLEAN",
            "type": "BOOLEAN",
            "links": [
              14
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "StringContains"
        },
        "widgets_values": [
          "DONE"
        ]
      },
      {
        "id": 17,
        "type": "String",
        "pos": [
          -761,
          -514
        ],
        "size": {
          "0": 316,
          "1": 58
        },
        "flags": {},
        "order": 16,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "STRING",
            "type": "STRING",
            "links": [
              23
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "String"
        },
        "widgets_values": [
          "Goal spec: cinematic golden retriever astronaut floating in a space station, dramatic lighting, ultra detailed, 35mm photography"
        ]
      },
      {
        "id": 18,
        "type": "StringConcat",
        "pos": [
          -381,
          -482
        ],
        "size": {
          "0": 320,
          "1": 82
        },
        "flags": {},
        "order": 17,
        "mode": 0,
        "inputs": [
          {
            "name": "a",
            "type": "STRING",
            "link": 23
          },
          {
            "name": "b",
            "type": "STRING",
            "link": 12
          }
        ],
        "outputs": [
          {
            "name": "STRING",
            "type": "STRING",
            "links": [
              21
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "StringConcat"
        },
        "widgets_values": [
          "\n",
          true
        ]
      },
      {
        "id": 19,
        "type": "String",
        "pos": [
          -761,
          -599
        ],
        "size": {
          "0": 316,
          "1": 58
        },
        "flags": {},
        "order": 18,
        "mode": 0,
        "inputs": [],
        "outputs": [
          {
            "name": "STRING",
            "type": "STRING",
            "links": [
              24
            ]
          }
        ],
        "properties": {
          "Node name for S&R": "String"
        },
        "widgets_values": [
          "If the critic returns DONE, the loop stops. Otherwise, use the returned prompt as the next iteration input."
        ]
      }
    ],
    "links": [
      [
        1,
        1,
        0,
        5,
        0,
        "MODEL"
      ],
      [
        2,
        1,
        1,
        2,
        0,
        "CLIP"
      ],
      [
        3,
        1,
        2,
        6,
        1,
        "VAE"
      ],
      [
        4,
        2,
        0,
        5,
        1,
        "CONDITIONING"
      ],
      [
        5,
        3,
        0,
        5,
        2,
        "CONDITIONING"
      ],
      [
        6,
        4,
        0,
        5,
        3,
        "LATENT"
      ],
      [
        7,
        5,
        0,
        6,
        0,
        "LATENT"
      ],
      [
        8,
        6,
        0,
        7,
        0,
        "IMAGE"
      ],
      [
        9,
        10,
        0,
        12,
        0,
        "LLAVA_MODEL"
      ],
      [
        10,
        11,
        0,
        12,
        1,
        "LLAVA_VISION"
      ],
      [
        11,
        12,
        0,
        13,
        0,
        "STRING"
      ],
      [
        12,
        13,
        0,
        18,
        1,
        "STRING"
      ],
      [
        13,
        14,
        0,
        15,
        0,
        "INT"
      ],
      [
        14,
        16,
        0,
        15,
        1,
        "BOOLEAN"
      ],
      [
        16,
        6,
        0,
        11,
        0,
        "IMAGE"
      ],
      [
        21,
        8,
        0,
        2,
        1,
        "STRING"
      ],
      [
        22,
        9,
        0,
        3,
        1,
        "STRING"
      ],
      [
        23,
        17,
        0,
        18,
        0,
        "STRING"
      ],
      [
        24,
        19,
        0,
        2,
        1,
        "STRING"
      ]
    ],
    "groups": [],
    "config": {},
    "extra": {
      "workflow_purpose": "Self-improving render loop with local vision LLM critique and prompt revision.",
      "notes": "Load in ComfyUI, install listed custom nodes, download required models, then queue the workflow to start the loop."
    }
  }
}
